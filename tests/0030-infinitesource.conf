%info
Simple performance test generating packets with InfiniteSource

%config
#Script is time-based on 2s, so if it is longer than 10s, there is a bug somewhere
timeout=10
#Accept 1% changes
acceptable=0.01
#Consider there was a problem if <1G
minimum=1000000000
tags=dpdk
var_names={BURST:Burst,LENGTH:60,result:Throughput}
var_unit={BURST:Packets,LENGTH:Bytes,result:BPS}
#var_lim={BURST:0-5}
title=InfiniteSource Packet Generation
legend_loc=upper left

%variables
BURST=[1*1024]
LENGTH=[64*1024]

%script
click -c 0x1 -n 4 -- CONFIG || click -j 1 CONFIG

%file CONFIG
is :: InfiniteSource(LENGTH $LENGTH, BURST $BURST)
    -> ac :: AverageCounter
    -> Discard;

finish :: Script(TYPE ACTIVE,
			wait 2s,
			print "RESULT $(mul $(ac.byte_rate) 8)",
			stop);
